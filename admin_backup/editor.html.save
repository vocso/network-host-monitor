<!DOCTYPE html>
<html>
<head>
  <title>Manage Hosts</title>
  <style>
    table, th, td {
      border: 1px solid #ccc;
      border-collapse: collapse;
      padding: 8px;
    }
    table {
      width: 100%;
      margin-bottom: 20px;
    }
    input {
      padding: 5px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <h2>Host List</h2>
  <table id="hostTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>IP</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <h3>Add / Edit Host</h3>
  <form onsubmit="saveHost(event)">
    <input type="hidden" id="editIndex" value="">
    <input type="text" id="name" placeholder="Name" required>
    <input type="text" id="ip" placeholder="IP" required>
    <button type="submit">üíæ Save</button>
  </form>

  <p id="msg"></p>

  <script>
    let hosts = [];

    async function loadData() {
      const res = await fetch('/data.json');
      hosts = await res.json();
      renderTable();
    }

    function renderTable() {
      const tbody = document.querySelector("#hostTable tbody");
      tbody.innerHTML = "";
      hosts.forEach((host, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${host.name}</td>
          <td>${host.ip}</td>
          <td>
            <button onclick="editHost(${index})">‚úèÔ∏è Edit</button>
            <button onclick="deleteHost(${index})">üóë Delete</button>
          </td>`;
        tbody.appendChild(row);
      });
    }

    function editHost(index) {
   aaaa   document.getElementById("editIndex").value = index;
      document.getElementById("name").value = hosts[index].name;
      document.getElementById("ip").value = hosts[index].ip;
    }

    function deleteHost(index) {
      if (confirm("Are you sure you want to delete this host?")) {
        hosts.splice(index, 1);
        updateServer();
      }
    }

    function saveHost(event) {
      event.preventDefault();
      const index = document.getElementById("editIndex").value;
      const name = document.getElementById("name").value;
      const ip = document.getElementById("ip").value;

      const newHost = { name, ip };

      if (index === "") {
        hosts.push(newHost);
      } else {
        hosts[parseInt(index)] = newHost;
      }

      document.getElementById("editIndex").value = "";
      document.getElementById("name").value = "";
      document.getElementById("ip").value = "";

      updateServer();
    }

    async function updateServer() {
      const res = await fetch('/save', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(hosts)
      });
      const result = await res.json();
      document.getElementById("msg").innerText = result.success ? "‚úÖ Saved!" : "‚ùå Failed to save: " + result.error;
      renderTable();
    }

    loadData();
  </script>
</body>
</html>
